# vim: filetype=bash

#### arg handling functions
argStripLast()
{
    echo "${@:1:$#-1}"
}

#### general functions
:only()
{
    PROG='!'"/^$$|ack/&&/$(basename $SHELL)"'$/{print$2}'
    ps -ao pid,ppid,comm= | awk "$PROG" | xargs kill
}

abspath()
{
    echo $(cd $(dirname "$1") && pwd -P)/$(basename "$1")
}

dolog()
{
    unbuffer $(argStripLast "${@}") | tee >(stripColor > "${HOME}/usr/log/${@: -1}")
}

dologall()
{
    unbuffer $(argStripLast "${@}") | tee "${HOME}/usr/log/${@: -1}"
}

findDirsContaining()
{
    find $1 -name $2 -exec dirname {} ';'
}

hist()
{
    grep $@ "${HOME}/.bash_history"
}

histtail()
{
    #tail -r "${HOME}/.bash_history" | grep -m 25 $@ | nl | sort -nr | cut -f 2-
    gtac "${HOME}/.bash_history" | grep -m 25 "${@}" | nl | sort -nr | cut -f 2-
}

greplast()
{
    #tail -r "${HOME}/.bash_history" | grep -m 25 $@ | nl | sort -nr | cut -f 2-
    gtac ${@:2:-1} | grep -m 25 ${@: 1} | nl | sort -nr | cut -f 2-
}

removeFilesInList()
{
    for f in $(cat $1) ; do 
        rm -r "$f"
    done
}

stripColor()
{
    sed -E $'s/\x1B\[([0-9]{1,2}(;[0-9]{1,2})?)?[mGK]//g'
}

